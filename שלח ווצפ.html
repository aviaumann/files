<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>砖转 注</title>
</head>
<body>
  <h2>专 砖 拽砖专  拽 住驻专 驻</h2>
  <input list="contactsList" id="contactInput" placeholder="拽 砖  住驻专">
  <datalist id="contactsList"></datalist>
  <p>住驻专 驻 : <span id="phoneDisplay">---</span></p>
  <button onclick="sendMessage()">砖</button>

  <hr>
  <h3>  爪 砖 拽砖专</h3>
  <button id="exportBtn"> 专 CSV</button>
  <input type="file" id="importInput" accept=".csv" style="display:none">
  <button id="importBtn"> 注 CSV</button>

  <script>
    let contacts = [
      { name: "砖 砖专", phone: "0526370400" },
      { name: "转专 驻专", phone: "0547468633" },
      { name: "专 ", phone: "0508773258" },
      { name: "拽 专", phone: "0508424304" },
      { name: "专", phone: "0545974004" },
      { name: "注", phone: "0584272000" },
      { name: "住 ", phone: "0526401155" },
      { name: "专 砖专注", phone: "0522570102" },
      { name: " ", phone: "0522944186" },
      { name: " ", phone: "0537292021" },
      { name: " 专专", phone: "0585824442" },
      { name: "注 ", phone: "0523505727" },
      { name: " ", phone: "0524255894" },
      { name: " ", phone: "0526677224" },
      { name: " 专", phone: "0543366933" },
      { name: "专 住", phone: "0547286060" },
      { name: "砖 拽", phone: "0585005455" },
      { name: " 专", phone: "0523115153" },
      { name: " 爪'爪'", phone: "0544514010" },
      { name: " ", phone: "0532392265" },
      { name: "", phone: "0549169981" },
      { name: "爪拽 ", phone: "0583222736" },
      { name: "专 拽", phone: "0585840229" },
      { name: "住 专", phone: "0549199868" },
      { name: " 砖专 抓", phone: "0586770000" },
      { name: "专 ", phone: "0528085379" },
      { name: " 专专", phone: "0547980544" },
      { name: " ", phone: "0547739831" }
    ];

    const input = document.getElementById("contactInput");
    const phoneDisplay = document.getElementById("phoneDisplay");

    function updateDatalist() {
      const datalist = document.getElementById("contactsList");
      datalist.innerHTML = "";
      contacts.forEach(contact => {
        const option = document.createElement("option");
        option.value = contact.name;
        datalist.appendChild(option);
      });
    }

    function normalizePhone(phone) {
      phone = phone.replace(/-/g, '').trim();
      if (/^972\d{8,9}$/.test(phone)) {
        return "0" + phone.slice(3);
      }
      return phone;
    }

    input.addEventListener("input", () => {
      const value = input.value.trim();
      const contact = contacts.find(c => c.name === value);
      let phone = "";

      if (contact) {
        phone = contact.phone;
      } else if (/^(0\d{8,9}|972\d{8,9})$/.test(value.replace(/-/g, ''))) {
        phone = normalizePhone(value);
      }

      phoneDisplay.textContent = phone || "---";
    });

    function sendMessage() {
      const phone = phoneDisplay.textContent;
      if (!/^0\d{8,9}$/.test(phone)) {
        alert("住驻专 驻  转拽");
        return;
      }
      const url = `https://mail.google.com/mail/u/0/?fs=1&tf=cm&source=mailto&su=${phone}&to=whatsapp@whatsappcall.ovh&body=${phone}`;
      window.open(url, '_blank', 'width=500,height=500');
    }

    document.addEventListener("keydown", function(e) {
      if (e.key === "Enter") sendMessage();
    });

    function saveContacts() {
      localStorage.setItem("myContacts", JSON.stringify(contacts));
    }

    function loadContacts() {
      const saved = localStorage.getItem("myContacts");
      if (saved) {
        try {
          contacts = JSON.parse(saved);
        } catch {}
      }
    }

    //  CSV
    document.getElementById("importBtn").addEventListener("click", () => {
      document.getElementById("importInput").click();
    });

    document.getElementById("importInput").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (event) {
        const lines = event.target.result.split("\n");
        let added = 0;
        lines.forEach(line => {
          const [nameRaw, phoneRaw] = line.split(",");
          if (!nameRaw || !phoneRaw) return;
          const name = nameRaw.replace(/"/g, "").trim();
          const phone = phoneRaw.replace(/"/g, "").trim().replace(/-/g, "");
          if (!contacts.some(c => c.name === name) && /^0\d{8,9}$/.test(phone)) {
            contacts.push({ name, phone });
            added++;
          }
        });
        saveContacts();
        updateDatalist();
        alert(`注 ${added} 砖 拽砖专 砖`);
        e.target.value = "";
      };
      reader.readAsText(file, "UTF-8");
    });

    // 爪 CSV
    document.getElementById("exportBtn").addEventListener("click", () => {
      if (contacts.length === 0) return alert(" 砖 拽砖专 爪.");
      const csvContent = "data:text/csv;charset=utf-8," +
        contacts.map(c => `"${c.name}","${c.phone}"`).join("\n");
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "contacts.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    loadContacts();
    updateDatalist();
  </script>
</body>
</html>
